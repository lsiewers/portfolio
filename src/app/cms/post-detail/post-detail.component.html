<article class="work-detail cms-detail" *ngIf="data">
  <header class="work-detail__header cms-detail__header">
    <figure class="work-detail__header__media {{data.header.pos}}">
      <img *ngIf="data.header.type === 'image'" [src]="data.header.url">
      <video *ngIf="data.header.type === 'video'" muted="muted" autoplay loop>
        <source [src]="data.header.url"/>
      </video>
    </figure>
    <input class="cms-detail__header__img-input" type="text" [(ngModel)]="data.header.url">

    <select [(ngModel)]="data.header.type">
      <option value="image">Image</option>
      <option value="video">Video</option>
    </select>
    <select [(ngModel)]="data.header.pos">
      <option value="top">Top</option>
      <option value="center">Center</option>
      <option value="bottom">Bottom</option>
    </select>
    <input class="cms-detail__header__reference-input" type="text" [(ngModel)]="data.header.ref" placeholder="image reference caption">
    <h1 class="work-detail__header__title">
      <input
        class="cms-detail__header__title"
        [(ngModel)]="data.title"
        type="text">
    </h1>
    <p class="work-detail__header__subtitle cms-detail__header__subtitle">
      short description
      <textarea
        [(ngModel)]="data.subtitle"
        type="text"></textarea>
    </p>
  </header>
  <main class="work-detail__main cms-detail__main">
    <!-- Content -->

    <section class="work-detail__content cms-detail__main__content">
        <angular-editor [(ngModel)]="data.details" [config]="editorConfig"></angular-editor>
        <br>
        <button (click)="quickSave()" class="button button--dark">
          Quick Save
          <div class="icon margin--left" [inlineSVG]="'download.svg'"></div>
        </button>
        <a [routerLink]="'/'+postUrl" target="_blank" class="button button--dark">
          Preview page
          <div class="icon margin--left" [inlineSVG]="'outside.svg'"></div>
        </a>
    </section>

    <!-- Metadata -->
    <aside class="work-detail__metadata cms-detail__main__metadata">
      <small class="cms-detail__main__metadata__id">ID: {{data.id}}</small>
      <ul class="work-detail__metadata__list">
        <li
          *ngFor="let metadata of data.metadata | keyvalue;"
          class="work-detail__metadata__list__item {{metadata.key}}"
        >
          <h1>{{ metadata.key }}</h1>
          <p *ngIf="!isArray(metadata.value)">
            <input [(ngModel)]="data.metadata[metadata.key]" [ngModelOptions]="{ updateOn: 'blur' }" type="text">
          </p>
          <ng-container
            *ngIf="isArray(metadata.value)
            && metadata.key !== 'collaboration'
            && metadata.key !== 'links'">
            <p *ngFor="let value of metadata.value; let i = index">
              <input
                [(ngModel)]="metadata.value[i]"
                [ngModelOptions]="{'updateOn': 'blur'}"
                type="text"
                (keyup.enter)="addField(metadata, metadata.key)"
                (keyup.backspace)="removeField(metadata, i, $event)"
              >
            </p>
          </ng-container>
          <p *ngIf="metadata.key === 'collaboration'">
            <br><small>NAME</small><br>
            <input
              *ngFor="let value of metadata.value | keyvalue; let i = index"
              [(ngModel)]="metadata.value[i].name"
              type="text"
              (keyup.enter)="addField(data.metadata[metadata.key], metadata.key)"
              (keyup.backspace)="removeField(data.metadata[metadata.key], i, $event)"
            >
            <br><br><small>URL</small><br>
            <input
              *ngFor="let value of metadata.value | keyvalue; let i = index"
              [(ngModel)]="metadata.value[i].url"
              type="text"
              (keyup.enter)="addField(data.metadata[metadata.key], metadata.key)"
              (keyup.backspace)="removeField(data.metadata[metadata.key], i, $event)"
            >
            <!-- <input [(ngModel)]="subdata.values" type="date"> -->
          </p>
          <p *ngIf="metadata.key === 'finishDate'">
            <input [(ngModel)]="data.metadata[metadata.key]" [ngModelOptions]="{ updateOn: 'blur' }" type="date">
          </p>
          <p *ngIf="metadata.key === 'links'">
            <br><small>NAME</small><br>
            <input
              *ngFor="let value of metadata.value | keyvalue; let i = index"
              [(ngModel)]="metadata.value[i].name"
              type="text"
              (keyup.enter)="addField(data.metadata[metadata.key], metadata.key)"
              (keyup.backspace)="removeField(data.metadata[metadata.key], i, $event)"
            >
            <br><br><small>ICON</small><br>
            <input
              *ngFor="let value of metadata.value | keyvalue; let i = index"
              [(ngModel)]="metadata.value[i].icon"
              type="text"
              (keyup.enter)="addField(data.metadata[metadata.key], metadata.key)"
              (keyup.backspace)="removeField(data.metadata[metadata.key], i, $event)"
            >
            <br><br><small>URL</small><br>
            <input
              *ngFor="let value of metadata.value | keyvalue; let i = index"
              [(ngModel)]="metadata.value[i].url"
              type="text"
              (keyup.enter)="addField(data.metadata[metadata.key], metadata.key)"
              (keyup.backspace)="removeField(data.metadata[metadata.key], i, $event)"
            >
            <!-- <input [(ngModel)]="subdata.values" type="date"> -->
          </p>
        </li>
      </ul>
    </aside>
  </main>
  <footer class="cms-detail__footer">
    <div class="cms-detail__footer__images">
        <h1>Gallery</h1>
      <ul>
        <li *ngFor="let file of mediaFiles">
          <ng-container *ngIf="file.metadata | async as metadata">
            <object
              *ngIf="metadata.type.includes('pdf')"
              [data]="file.url | safe: 'resourceUrl'"
              height="200" width="200"
            >
            </object>
            <img
              *ngIf="metadata.type.includes('image')"
              [src]="file.url"
            >
            <video
              muted autoplay loop controls
              *ngIf="metadata.type.includes('video')"
              (click)="toClipboard($event)"
            ><source [src]="file.url">
            </video>
            <pre
              [class.green]="metadata.size / 1024 < 500"
              [class.orange]="metadata.size / 1024 > 500 && metadata.size / 1024 < 1000"
              [class.red]="metadata.size / 1024 > 1000"
            >{{ calcFileSize(metadata.size) }}</pre>
            <small>{{ file.name }}</small>
            <button class="button button--dark" (click)="deleteFile(file.name)">delete</button>
            <button
              class="button button--dark"
              (click)="setHeader(file.url, metadata.type)"
              *ngIf="metadata.type.includes('image') || metadata.type.includes('video')"
            >
              Header {{ metadata.type.includes('image') ? 'image' : 'video' }}
            </button>
          </ng-container>
        </li>
      </ul>
      <input
        class="button button--dark file-upload"
        type="file"
        accept=".png, .jpeg, .jpg,.gif, .mp4, .mov, .pdf, .svg"
        (change)="uploadFile($event)"
      >
    </div>
    <div class="cms-detail__footer__buttons">
      <button class="button button--dark delete" (click)="delete();">Delete</button>
      <button class="button button--dark save" (click)="save()">
        Save
        <div class="icon margin--left" [inlineSVG]="'download.svg'"></div>
      </button>
    </div>
  </footer>
</article>
